# Книжный каталог - RESTful API

Веб-приложение "Книжный каталог" представляет собой RESTful API для управления информацией о книгах, авторах и отзывах. Приложение разработано на Python с использованием фреймворка Flask и поддерживает работу с различными базами данных.

## Особенности

- RESTful API с поддержкой операций CRUD для всех сущностей (авторы, книги, отзывы)
- Поддержка нескольких баз данных:
  - SQLite (в памяти) - основная база данных
  - PostgreSQL - дополнительная база данных
  - MySQL - дополнительная база данных
- In-memory хранилище для высокопроизводительных операций
- Структурированная архитектура приложения
- Тесты для проверки основной функциональности
- Безопасность от основных уязвимостей

## Технический стек

- Python 3.8+
- Flask - веб-фреймворк
- SQLAlchemy - ORM для работы с базами данных
- Flask-SQLAlchemy - интеграция Flask и SQLAlchemy
- Flask-Migrate - для миграций баз данных
- Marshmallow - сериализация/десериализация данных
- PyTest - тестирование

## Структура проекта

```
book_catalog/
│
├── app/
│   ├── __init__.py         # Фабрика приложения
│   ├── config.py           # Настройки конфигурации
│   ├── models.py           # Модели данных
│   ├── routes.py           # API маршруты
│   ├── services.py         # Бизнес-логика
│   └── utils.py            # Вспомогательные функции
│
├── tests/
│   ├── __init__.py
│   └── test_app.py         # Тесты приложения
│
├── .gitignore              # Git ignore файл
├── README.md               # Документация проекта
├── requirements.txt        # Зависимости проекта
└── run.py                  # Точка входа для запуска приложения
```

## Установка и запуск

### Предварительные требования

- Python 3.8+
- pip (менеджер пакетов Python)
- Виртуальное окружение (рекомендуется)

### Установка

1. Клонируйте репозиторий:
   ```
   git clone <url-репозитория>
   cd книжный-каталог
   ```

2. Создайте и активируйте виртуальное окружение:
   ```
   python -m venv venv
   source venv/bin/activate  # Для Linux/Mac
   venv\Scripts\activate     # Для Windows
   ```

3. Установите зависимости:
   ```
   pip install -r requirements.txt
   ```

   Если возникают проблемы с установкой `psycopg2-binary` (драйвер PostgreSQL), вы можете:
   - Установить PostgreSQL на вашу систему
   - Или временно закомментировать эту зависимость, если вы планируете использовать только SQLite

4. Создайте файл `.env` для настройки переменных окружения:
   ```
   FLASK_CONFIG=development
   SECRET_KEY=ваш-секретный-ключ
   POSTGRES_URI=
   MYSQL_URI=
   ```

   Пустые значения для `POSTGRES_URI` и `MYSQL_URI` предотвратят попытки подключения к этим базам данных.

### Запуск

Запустите приложение:
```
python run.py
```

По умолчанию приложение запустится на http://0.0.0.0:5000

## API Endpoints

### Авторы

- `GET /api/authors` - Получить всех авторов
- `GET /api/authors/<id>` - Получить автора по ID
- `POST /api/authors` - Создать нового автора
- `PUT /api/authors/<id>` - Обновить существующего автора
- `DELETE /api/authors/<id>` - Удалить автора

### Книги

- `GET /api/books` - Получить все книги
- `GET /api/books/<id>` - Получить книгу по ID
- `POST /api/books` - Создать новую книгу
- `PUT /api/books/<id>` - Обновить существующую книгу
- `DELETE /api/books/<id>` - Удалить книгу

### Отзывы

- `GET /api/reviews` - Получить все отзывы
- `GET /api/books/<id>/reviews` - Получить все отзывы для конкретной книги
- `GET /api/reviews/<id>` - Получить отзыв по ID
- `POST /api/reviews` - Создать новый отзыв
- `PUT /api/reviews/<id>` - Обновить существующий отзыв
- `DELETE /api/reviews/<id>` - Удалить отзыв

### In-Memory хранилище

- `GET /api/memory` - Получить все данные из хранилища в памяти
- `GET /api/memory/<key>` - Получить данные по ключу из хранилища в памяти
- `POST /api/memory/search` - Добавить поисковый запрос в память
- `PUT /api/memory/metrics` - Обновить метрики сайта

## Работа с API через командную строку

### Особенности вывода JSON с русскими символами

При использовании `curl` или подобных инструментов командной строки для запросов к API, русские символы будут отображаться в Unicode-формате (например, `\u0427\u0438\u0441\u0442\u044b\u0439 \u043a\u043e\u0434` вместо "Чистый код"). Это нормальное поведение для JSON.

### Получение читаемого вывода

1. **С использованием Python**:
   ```bash
   curl http://localhost:5000/api/authors | python -m json.tool
   ```

2. **С использованием jq** (необходимо установить):
   ```bash
   # Установка jq на Ubuntu/Debian
   apt-get install jq
   
   # Использование
   curl http://localhost:5000/api/authors | jq
   ```

3. **Просмотр в браузере**:
   Просто откройте URL в веб-браузере, который корректно отобразит символы:
   ```
   http://localhost:5000/api/authors
   ```

### Примеры запросов с curl

```bash
# Получить всех авторов
curl http://localhost:5000/api/authors

# Создать нового автора
curl -X POST -H "Content-Type: application/json" \
  -d '{"name":"Александр Пушкин","bio":"Русский поэт и писатель"}' \
  http://localhost:5000/api/authors

# Получить книги
curl http://localhost:5000/api/books

# Создать новую книгу
curl -X POST -H "Content-Type: application/json" \
  -d '{"title":"Евгений Онегин","author_id":5,"isbn":"1234567890123","price":1200}' \
  http://localhost:5000/api/books
```

## Тестирование

Запуск тестов:
```
python -m pytest
```

## Безопасность

Приложение включает в себя следующие меры безопасности:

- Санитизация пользовательского ввода для предотвращения XSS и инъекционных атак
- Безопасное хеширование паролей с использованием соли
- Защита от CSRF-атак
- Ограничение частоты запросов (rate limiting)
- Использование параметризованных запросов к БД для предотвращения SQL-инъекций

## Решение проблем

### Ошибки подключения к базам данных

Если вы видите ошибки подключения к PostgreSQL или MySQL при запуске приложения, создайте файл `.env` с пустыми значениями для URI этих баз данных:

```
FLASK_CONFIG=development
SECRET_KEY=ваш-секретный-ключ
POSTGRES_URI=
MYSQL_URI=
```

### Данные сбрасываются при перезапуске приложения

Это ожидаемое поведение, так как по умолчанию используется SQLite в памяти. Если вам нужно сохранение данных, настройте подключение к постоянной БД в файле `.env`.

## Лицензия

MIT


TEST EDIT
